name: Build OCR Scanner APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: â˜• Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ðŸ¤– Setup Android SDK
      uses: android-actions/setup-android@v3
      
    - name: ðŸ”§ Make gradlew executable
      run: chmod +x gradlew
      
    - name: ðŸ’¾ Cache Gradle dependencies
      uses: actions/cache@v4
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: gradle-${{ hashFiles('**/gradle-wrapper.properties') }}
        restore-keys: |
          gradle-
          
    - name: ðŸ—ï¸ Build Debug APK
      run: |
        ./gradlew assembleDebug --no-daemon
        
    - name: ðŸ“¦ Upload Debug APK
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: OCR-Scanner-Debug
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 7
        
    - name: ðŸ“ Generate APK Info
      if: success()
      run: |
        echo "# ðŸ“± OCR Scanner APK" > README-APK.md
        echo "" >> README-APK.md
        echo "## ðŸ“‹ Informations" >> README-APK.md
        echo "- **Version:** 1.0.0" >> README-APK.md
        echo "- **Date:** $(date '+%Y-%m-%d %H:%M:%S')" >> README-APK.md
        echo "- **Commit:** ${{ github.sha }}" >> README-APK.md
        echo "" >> README-APK.md
        echo "## ðŸ“² Installation" >> README-APK.md
        echo "1. TÃ©lÃ©chargez `app-debug.apk` depuis Artifacts" >> README-APK.md
        echo "2. Sur Android :" >> README-APK.md
        echo "   - Allez dans **ParamÃ¨tres â†’ SÃ©curitÃ©**" >> README-APK.md
        echo "   - Activez **Sources inconnues**" >> README-APK.md
        echo "   - Installez l'APK" >> README-APK.md
        echo "" >> README-APK.md
        echo "## âœ¨ FonctionnalitÃ©s" >> README-APK.md
        echo "- ðŸ“¸ Camera en temps rÃ©el" >> README-APK.md
        echo "- ðŸ” Reconnaissance de texte (OCR)" >> README-APK.md
        echo "- ðŸ“ Import depuis galerie" >> README-APK.md
        echo "- ðŸ’¾ Sauvegarde du texte" >> README-APK.md
        
    - name: ðŸ“„ Upload APK Info
      uses: actions/upload-artifact@v4
      with:
        name: Documentation
        path: README-APK.md
        retention-days: 7
